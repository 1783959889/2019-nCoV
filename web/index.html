<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="Generator" content="EditPlus®">
	<meta name="Author" content="JackieZheng">
	<meta name="Keywords" content="2019-nCoV,肺炎,疫情,中华菊头蝠,冠状病毒,感染">
	<meta name="Description" content="2019-nCoV全国新型肺炎疫情趋势">
	<title>全国新型肺炎疫情每日动态</title>

	<link href="../Css/tooltipster.min.css" rel="stylesheet">
	<link href="../Css/tooltipster-shadow.min.css" rel="stylesheet">
	<script src="../Js/jquery.min.js"></script>
	<script src="../Js/echarts.min.js"></script>
	<script src="../Js/Date.prototype.js"></script>
	<script src="../Js/jquery.color.min.js"></script>
	<script src="../Js/jquery.animateNumber.min.js"></script>
	<script src="../Js/jquery.tooltipster.min.js"></script>
	<style>
		html,
		body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
		}

		#dataFrom {
			font-size: 12px;
			text-align: right;
			margin-right: 40px;
			color: #999;
		}

		#dataFrom a,
		#dataFrom a:active,
		#dataFrom a:hover {
			font-size: 12px;
			color: #999;
			text-decoration: none;
		}

		#main {
			margin-top: -20px;
			width: 100%;
			height: calc(100% - 130px);
		}

		#realTimeData {
			border: 2px solid #eee;
			border-radius: 10px;
			margin: 10px;
			background-color: #639a081f;
			display: inline-block;
			width: calc(100% - 26px);
		}

		.statistics {
			display: flex;
			margin: 5px;
			padding: 0;
		}

		.statistics li {
			display: flex;
			flex: 1 1;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}

		.statistics li span {
			color: #666;
			font-size: 12px;
		}

		.datatitle {
			font-size: 18px;
			font-weight: bold;
			text-align: center;
			color: #2d9fe2e8;
		}

		.datasubtitle {
			font-size: 14px;
			padding: 5px 50px;
			text-align: center;
			color: #999;
			cursor: pointer;
		}

		.datasubtitle::after {
			content: "?";
			font-size: 10px;
			margin: -5px 5px;
			text-align: center;
			color: #fff;
			width: 10px;
			height: 10px;
			line-height: 10px;
			padding: 0;
			position: absolute;
			border: 1px solid #ccc;
			border-radius: 100%;
			background-color: #ccc;
		}

		.statistics li strong {
			font-size: 24px;
			cursor: pointer;
		}

		.statistics li strong::after {
			content: attr(dataContent);
			color: #3186cf6b;
			font-size: 12px;
			position: absolute;
			margin: -5px 5px;
		}

		.statistics li span::after {
			content: attr(dataContent);
			color: #3186cf6b;
			font-size: 12px;
			position: absolute;
			margin: -5px 5px;
		}

		.tooltipster-shadow {
			opacity: 0.9;
		}
	</style>
</head>

<body>
	<div id="realTimeData">
		<div class="datatitle">全国疫情实时数据统计</div>
		<div class="datasubtitle tooltip" title="数据每5分钟自动刷新一次，如有更新会在数字右上角提示。数字右下角为相对昨天数据变化。">(截至 2020-01-31 08:09)</div>
		<ul class="statistics">
			<li>
				<strong style="color: rgb(247, 76, 49);" dataContent="">0</strong>
				<span dataContent="0">确诊病例</span>
			</li>
			<li>
				<strong style="color: rgb(247, 130, 7);" dataContent="">0</strong>
				<span dataContent="0">疑似病例</span>
			</li>
			<li>
				<strong style="color: rgb(93, 112, 146);" dataContent="">0</strong>
				<span dataContent="0">死亡人数</span>
			</li>
			<li>
				<strong style="color: rgb(40, 183, 163);" dataContent="">0</strong>
				<span dataContent="0">治愈人数</span>
			</li>
		</ul>
	</div>
	<div id="main"></div>
	<div id="dataFrom">(数据来源：<a href="http://www.nhc.gov.cn/xcs/yqtb/list_gzbd.shtml" target="_blank">国家卫健委</a>)</div>
	<script type="text/javascript">
		var yesterday_confirmed = 0, yesterday_unconfirmed = 0, yesterday_died = 0, yesterday_cured = 0

		var myChart = echarts.init(document.getElementById('main'));
		var dataSource = [];

		$.ajaxSettings.async = false;
		$.getJSON("../Json/data.json?" + Date.parse(new Date()), function (data) {
			dataSource = data;
			var yesterday_data = data.filter(item => (new Date(item.日期)).Format("yyyy/M/d") == (new Date()).DateAdd("d", -1).Format("yyyy/M/d"));
			console.log(yesterday_data);
			if (yesterday_data.length > 0) {
				yesterday_confirmed = ~~yesterday_data[0].确诊;
				yesterday_unconfirmed = ~~yesterday_data[0].疑似;
				yesterday_died = ~~yesterday_data[0].死亡;
				yesterday_cured = ~~yesterday_data[0].治愈;
			}
		})

		option = {
			title: {
				text: '全国新型肺炎疫情趋势',
				x: 'center',
				y: 'top',
				top: '20px'
			},
			legend: {
				x: 'center',
				y: 'bottom',
				itemGap: 3
			},
			grid: {
				left: "15%"
			},
			tooltip: {},
			dataset: {
				dimensions: ['日期', '确诊', '疑似', '重症', '死亡', '治愈', '确认+疑似', '新增(疑似+确认)', '观察中'],
				source: dataSource,
			},
			xAxis: { type: 'category' },
			yAxis: {},
			dataZoom: [
			],
			series: [
				{ type: 'bar' },
				{ type: 'bar' },
				{ type: 'bar' },
				{ type: 'bar' },
				{ type: 'bar' },
				{
					type: 'line',
					label: {
						normal: {
							show: true,
							position: 'top',
						},


					}
				},
				{
					type: 'line',
					label: {
						normal: {
							show: true,
							position: 'top',
						}
					}
				},
				{
					type: 'line',
					label: {
						normal: {
							show: true,
							position: 'top',
						}
					}
				}
			]
		};
		myChart.setOption(option);
		window.onresize = () => this.myChart.resize();

		update();

		$('.tooltip').tooltipster({
			theme: 'tooltipster-shadow'
		});

		$(".statistics>li>strong").each(function () {
			$(this).bind("click", function () {
				$(this).attr('dataContent', '');
			})


		});

		window.setInterval(() => update(), 1000 * 60 * 5);

		function update() {
			$.getJSON("https://service-nxxl1y2s-1252957949.gz.apigw.tencentcs.com/release/newpneumonia/" + Date.parse(new Date()), function (newpneumoniadata) {
				$(".datasubtitle").text("(截至 " + newpneumoniadata.data.conf.component[0].mapLastUpdatedTime + ")");

				var summaryDataIn = newpneumoniadata.data.conf.component[0].summaryDataIn;

				freshDataNum($(".statistics>li>strong").eq(0), summaryDataIn.confirmed);
				freshDataNum($(".statistics>li>strong").eq(1), summaryDataIn.unconfirmed);
				freshDataNum($(".statistics>li>strong").eq(2), summaryDataIn.died);
				freshDataNum($(".statistics>li>strong").eq(3), summaryDataIn.cured);

				$(".statistics>li>span").eq(0).attr('dataContent', '+' + (summaryDataIn.confirmed - yesterday_confirmed));
				$(".statistics>li>span").eq(1).attr('dataContent', '+' + (summaryDataIn.unconfirmed - yesterday_unconfirmed));
				$(".statistics>li>span").eq(2).attr('dataContent', '+' + (summaryDataIn.died - yesterday_died));
				$(".statistics>li>span").eq(3).attr('dataContent', '+' + (summaryDataIn.cured - yesterday_cured));

				console.log(summaryDataIn);
			})
		}

		function freshDataNum(target, newNum) {

			var oldNum = ~~(target.text());
			var increaseNum = ~~(target.attr('dataContent'));

			if (oldNum != 0 && (newNum - oldNum) != 0) {
				target.attr('dataContent', '+' + (increaseNum + (newNum - oldNum)));
			}
			else {
				//target.attr('dataContent', '');
			}

			target
				.prop('number', oldNum)
				.animateNumber({ number: newNum }, 3000);
		}




	</script>
</body>

</html>